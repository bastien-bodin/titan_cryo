/*----------------*- C++ -*----------------*/
FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    location    "system";
    object      fvSolution;
}
// * * * * * * * * * * * * * * * * * * * //

solvers
{
    // --- Phase Fraction (Alpha) ---
    "alpha.water.*"
    {
        nAlphaCorr      1;      // Correct the interface once per step
        nAlphaSubCycles 2;      // Sub-cycle twice to stabilize
        cAlpha          1;      // Interface compression factor (1 is standard)
        
        MULESCorr       yes;
        nLimiterIter    5;
        
        solver          smoothSolver;
        smoother        symGaussSeidel;
        tolerance       1e-8;
        relTol          0;
    }

    // --- Pressure (p_rgh) ---
    "p_rgh.*"
    {
        solver          GAMG;   // Multi-grid solver (Fastest for pressure)
        tolerance       1e-7;
        relTol          0.01;
        
        smoother        GaussSeidel;
        
        // Coarsest grid settings
        nPreSweeps      0;
        nPostSweeps     2;
        cacheAgglomeration on;
        agglomerator    faceAreaPair;
        nCellsInCoarsestLevel 10;
        mergeLevels     1;
    }

    // --- Velocity (U), Energy (T/e), Turbulence (k/epsilon) ---
    "(U|T|e|k|epsilon).*"
    {
        solver          smoothSolver;
        smoother        symGaussSeidel;
        tolerance       1e-6;
        relTol          0.1;
    }
}

PIMPLE
{
    momentumPredictor   yes;    // Solve U before p (helps convergence)
    nOuterCorrectors    2;      // Loop twice over the whole system
    nCorrectors         2;      // Correct pressure twice inside
    nNonOrthogonalCorrectors 1; // Handle mesh skewness
    
    // Under-relaxation is crucial for stability in PIMPLE
    // It prevents the solution from changing too wildly
}

relaxationFactors
{
    equations
    {
        ".*"            1;      // No relaxation for final equations
    }
    
    fields
    {
        "p_rgh"         0.3;    // Relax pressure (prevent spikes)
        "U"             0.7;    // Relax velocity
        "(T|e)"         0.5;    // Relax energy
    }
}